<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Nam Nguyen">
<meta name="description" content="Modeling and simulating a Thrust Vector Control rocket using Python" />
<meta name="keywords" content="homepage, blog, tech, engineering, portfolio, cybersecurity, embedded systems, electronics, programming, science, simulation" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://namberino.github.io/posts/2024/06/modeling-a-thrust-vector-control-rocket-in-python/" />


    <title>
        
            Modeling a Thrust Vector Control Rocket in Python :: Nam&#39;s Journal 
        
    </title>





  <link rel="stylesheet" href="/main.min.244183cde1a38e0b08f82c11791181288f9aac1cc9618cd6f4e9e7710c5768ba.css" integrity="sha256-JEGDzeGjjgsI&#43;CwReRGBKI&#43;arBzJYYzW9OnncQxXaLo=" crossorigin="anonymous">





    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">



  <meta itemprop="name" content="Modeling a Thrust Vector Control Rocket in Python">
  <meta itemprop="description" content="Modeling and simulating a Thrust Vector Control rocket using Python">
  <meta itemprop="datePublished" content="2024-06-05T20:31:39+07:00">
  <meta itemprop="dateModified" content="2024-06-05T20:31:39+07:00">
  <meta itemprop="wordCount" content="4251">
  <meta itemprop="image" content="https://namberino.github.io/">
  <meta itemprop="keywords" content="Programming,Science,Simulation">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://namberino.github.io/">
  <meta name="twitter:title" content="Modeling a Thrust Vector Control Rocket in Python">
  <meta name="twitter:description" content="Modeling and simulating a Thrust Vector Control rocket using Python">



    <meta property="og:url" content="https://namberino.github.io/posts/2024/06/modeling-a-thrust-vector-control-rocket-in-python/">
  <meta property="og:site_name" content="Nam&#39;s Journal">
  <meta property="og:title" content="Modeling a Thrust Vector Control Rocket in Python">
  <meta property="og:description" content="Modeling and simulating a Thrust Vector Control rocket using Python">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-05T20:31:39+07:00">
    <meta property="article:modified_time" content="2024-06-05T20:31:39+07:00">
    <meta property="article:tag" content="Programming">
    <meta property="article:tag" content="Science">
    <meta property="article:tag" content="Simulation">
    <meta property="og:image" content="https://namberino.github.io/">






    <meta property="article:published_time" content="2024-06-05 20:31:39 &#43;0700 &#43;07" />












<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false}
            ]
        });
    });
</script>

    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                nam$journal</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
                <span class="theme-toggle not-selectable" style="margin-left: 1.5rem; margin-right: 1rem;">
    
        
            
            <a class="active language" style="text-decoration: underline;"> EN </a>
            
                <div style="margin-left: 0.12rem; margin-right: 0.12rem;"> | </div>
            
        
    
        
            
                <a href="https://namberino.github.io/vi/posts/2024/06/m%C3%B4-ph%E1%BB%8Fng-t%C3%AAn-l%E1%BB%ADa-%C4%91i%E1%BB%81u-ch%E1%BB%89nh-vect%C6%A1-%C4%91%E1%BA%A9y-trong-python/" style="text-decoration: none;"> VI </a>
            
        
    

</span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        20 minutes

         | Also available in
          
              <a href="https://namberino.github.io/vi/posts/2024/06/m%C3%B4-ph%E1%BB%8Fng-t%C3%AAn-l%E1%BB%ADa-%C4%91i%E1%BB%81u-ch%E1%BB%89nh-vect%C6%A1-%C4%91%E1%BA%A9y-trong-python/"><span class="flag fi fi-"></span></a>
          
        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://namberino.github.io/posts/2024/06/modeling-a-thrust-vector-control-rocket-in-python/">Modeling a Thrust Vector Control Rocket in Python</a>
      </h1>

      
        <div class="post-excerpt">Modeling and simulating a Thrust Vector Control rocket using Python</div>
      

      
        <hr />
        <aside id="toc">
          <div class="toc-title">Table of Contents</div>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#measuring-the-actual-rocket">Measuring the actual rocket</a></li>
    <li><a href="#3-degrees-of-freedom">3 Degrees of Freedom</a></li>
    <li><a href="#implementing-the-3dof-function">Implementing the 3DOF function</a></li>
    <li><a href="#thrust-profile">Thrust profile</a></li>
    <li><a href="#implementing-the-thrust-profile-generation-function">Implementing the thrust profile generation function</a></li>
    <li><a href="#making-the-simulation">Making the simulation</a>
      <ul>
        <li><a href="#plotting-the-simulation-data-with-no-gimbal-angle">Plotting the simulation data with no gimbal angle</a></li>
        <li><a href="#plotting-the-simulation-data-with-some-gimbal-angle">Plotting the simulation data with some gimbal angle</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
        </aside>
        <hr />

      

      <div class="post-content">
        <p>Rocketry has always been a fascinating topic for me and I&rsquo;d love to get into model rocketry because it seems so interesting. Unfortunately, due to where I live, I can&rsquo;t really get into it due to lack of materials, cost, and local laws. So what&rsquo;s a guy to do when he wants to get into rocketry but can&rsquo;t physically do it? He goes the virtual simulation route.</p>
<p>I&rsquo;ll be building a simulation for a simple thrust vector control (<strong>TVC</strong>) rocket. This rocket will be modeled pretty accurately to life, it won&rsquo;t be 100% realistic since it&rsquo;s just a simulation, but it will be mostly correct. I&rsquo;ll be documenting everything from start to finish so that anyone who wants to can follow along.</p>
<blockquote>
<p>Note: We won&rsquo;t be simulating anything like wind speed or air resistances because that&rsquo;s a little too complex for the scope of this project. We also won&rsquo;t be going into any PID or any control stuff. I might add these extra factors and implement some controls into this simulation in the future though.</p>
</blockquote>
<h2 id="measuring-the-actual-rocket">Measuring the actual rocket</h2>
<p>A really important measurement that we need in order to make our simulation is the <em>mass moment of inertia</em>. Mass moment of inertia is about the density across the rocket, this density will come to affect the inertia of the rocket and how &ldquo;resistant&rdquo; the rocket will be to change in inertia. The mass distribution also what comes into play when we need to know about the density across the rocket.</p>
<p>I&rsquo;ll explain briefly about the measurements and how they are taken. If you want a detailed explanation and demonstration, check out <a href="https://www.youtube.com/watch?v=nwgd1CV__rs">this BPS space video</a>. I took the measurements from that video as I don&rsquo;t have any way to do the measurements on an actual model rocket.</p>
<p>To calculate the mass moment of inertia, we&rsquo;ll first need the mass (in <em>kg</em>) of the rocket, so just put the rocket on the scale and you&rsquo;re good to go. Our rocket will have a mass of $0.543kg$</p>
<p>Next, we&rsquo;ll get the COM-string amount, which will be $0.3m$. And the string length measurement will be $0.65m$. This is the distance of the hang string from the center of mass.</p>
<p>Next, we&rsquo;ll need to get the moment arm measurement of the rocket. Moment arm is the distance between the attach point of the thrust vector control thruster and the center of mass of the rocket. This measurement will come in handy when we need to calculate for torque. Our moment arm value will be $0.28m$</p>
<p>Next, we&rsquo;ll need the rotation time between each oscillations, which is basically getting the average time between each oscillation. Our rotation time will be $1.603s$.</p>
<p>Again, this is just a brief explanation on what these measurements are, if you want to see how to actually measure these values, check out the BPS space video above.</p>
<p>To recap, here&rsquo;s all the measurements and constants that we need to calculate the mass moment of inertia:</p>
<ul>
<li>Rocket mass: $m = 0.543kg$</li>
<li>Gravitational constant: $g = 9.81 m / s^2$</li>
<li>Rotation time: $R_t = 1.603s$</li>
<li>Distance between center of mass and string: $d = 0.3m$</li>
<li>Length of string: $l = 0.65m$</li>
</ul>
<p>We can then plug these values into the mass moment of inertia equation:</p>
<p>$$
MMOI = \frac{m * g * R_t^2 * d^2}{4 \pi^2 * l}
$$</p>
<p>This will give us an MMOI value of $0.048kg \cdot m^2$. With this value and the moment arm value ($0.28m$), we can now build a program to simulate this rocket.</p>
<h2 id="3-degrees-of-freedom">3 Degrees of Freedom</h2>
<p>A rocket will usually have 3 degrees of freedom (<em>3DOF</em>), the pitch, the yaw, and the roll. This image (from <a href="https://en.wikipedia.org/wiki/Six_degrees_of_freedom">Wikipedia</a>) will give you a pretty nice visualization on what all these degrees are.</p>

    <img src="/img/tvc-modeling/3dof-visual.png"  alt="3DOF visualization"  class="center"  style="padding: 10px"  />


<p>A 3DOF function will help simulate the flight dynamics of the rocket by modeling motions and angles based on the forces and moments applied on it. For this rocket, since we&rsquo;re doing a 2D simulation, we&rsquo;ll need to make a 3DOF function to take into account the rotation in the vertical plane about a flat reference frame. We&rsquo;ll only need to care about the X and Z axes since we&rsquo;re going 2D so no need to worry about the Y axis.</p>
<p>We&rsquo;ll need to take in the data of the forces, moments, and mass of the rocket so as to accurately simulate its dynamics. The output will represent the information about the rocket at any time during flight.</p>
<p>Our 3DOF function will need to take in these values:</p>
<ul>
<li>The forces on the X and Z axes ($Fx$ and $Fz$)</li>
<li>The pitching moment ($My$): Represents the torque due to thrust</li>
</ul>
<p>This 3DOF function will output these values:</p>
<ul>
<li>Pitch angle ($\theta$): The angle between the body axis and the reference plane</li>
<li>Pitch angular rate ($q$): The rate of change of the pitch angle</li>
<li>Pitch angular acceleration ($dqdt$): The rate of change of the pitch angular rate</li>
<li>Position ($(x, z)$): Position coordinate of the rocket</li>
<li>Velocity ($(u, w)$): The velocity in the X and Z axis of the rocket</li>
<li>Acceleration ($(Ax, Az)$): The acceleration of the rocket</li>
</ul>
<p>This is the pitch in a rocket:</p>

    <img src="/img/tvc-modeling/rocket-pitch.png"  alt="Rocket&#39;s pitch"  class="center"  style="padding: 10px"  />


<h2 id="implementing-the-3dof-function">Implementing the 3DOF function</h2>
<p>Before we start coding, we&rsquo;re going to need to import numpy and matplotlib:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#c678dd">import</span> <span style="color:#e06c75">numpy</span> <span style="color:#c678dd">as</span> <span style="color:#e06c75">np</span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">import</span> <span style="color:#e06c75">matplotlib.pyplot</span> <span style="color:#c678dd">as</span> <span style="color:#e06c75">plt</span>
</span></span></code></pre></div><p>Let&rsquo;s start implementing a 3DOF function in Python. This function needs the initial values of the rocket when it has not been launched then it will calculate the state of the rocket as the time increases and we apply thrust to it:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#98c379">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">Inputs:
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">- Fx: Force in the body x-direction (N)
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">- Fz: Force in the body z-direction (N)
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">- My: Pitching moment, represents torque (Nm)
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">- u0: Initial velocity in x (body axis)
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">- w0: Initial velocity in z (body axis)
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">- theta0: Initial pitch angle
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">- q0: Initial pitch rate
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">- pos0: Starting position [x, z]
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">- mass: Mass of the rocket
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">- inertia: Mass moment of inertia
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">- g: Grativational constant
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">- dt: Time step
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">- duration: Duration of simulation
</span></span></span><span style="display:flex;"><span><span style="color:#98c379">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">def</span> <span style="color:#61afef;font-weight:bold">three_dof_body_axes</span>(<span style="color:#e06c75">Fx</span>, <span style="color:#e06c75">Fz</span>, <span style="color:#e06c75">My</span>, <span style="color:#e06c75">u0</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.0</span>, <span style="color:#e06c75">w0</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.0</span>, <span style="color:#e06c75">theta0</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.0</span>, <span style="color:#e06c75">q0</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.0</span>, <span style="color:#e06c75">pos0</span><span style="color:#56b6c2">=</span>[<span style="color:#d19a66">0.0</span>, <span style="color:#d19a66">0.0</span>], <span style="color:#e06c75">mass</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0</span>, <span style="color:#e06c75">inertia</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.0</span>, <span style="color:#e06c75">g</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">9.81</span>, <span style="color:#e06c75">dt</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.01</span>, <span style="color:#e06c75">duration</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">10</span>):
</span></span></code></pre></div><p>Note that the time step represent a discrete time interval over which calculations will be performed to approximate the continuous changes in the rocket.</p>
<p>All of these values has been set to a default value which we can change later on.</p>
<p>Next, we&rsquo;ll assign these values to an internal variable so that we can operate on these values:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#e06c75">pos</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>(<span style="color:#e06c75">pos0</span>, <span style="color:#e06c75">dtype</span><span style="color:#56b6c2">=</span><span style="color:#e5c07b">float</span>) <span style="color:#7f848e"># this ensures that pos0 is a float array</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">u</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">u0</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">w</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">w0</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">vel</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>([<span style="color:#e06c75">u</span>, <span style="color:#e06c75">w</span>]) <span style="color:#7f848e"># assign velocity in X and Z axes to a single variable</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">theta</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">theta0</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">q</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">q0</span>
</span></span></code></pre></div><p>While we&rsquo;re assigning these initial values, we need to also calculate the initial acceleration in the X and Z axes. The calculation is quite easy, we just grab the initial forces in the X and Z axes and divide it by mass (classic $F=ma$), but we need to make sure to subtract the gravitational constant from the acceleration in the Z axis because of gravity. Since our forces in the X and Z axes are stored in arrays (for reasons you&rsquo;ll see later on), we can just access the initial forces by getting the 0th element:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#e06c75">ax</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fx</span>[<span style="color:#d19a66">0</span>] <span style="color:#56b6c2">/</span> <span style="color:#e06c75">mass</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">az</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fz</span>[<span style="color:#d19a66">0</span>] <span style="color:#56b6c2">/</span> <span style="color:#e06c75">mass</span> <span style="color:#56b6c2">-</span> <span style="color:#e06c75">g</span>
</span></span></code></pre></div><p>Then we&rsquo;ll initialize a list to store the calculated output values. These list will hold the information of the rocket at each time interval during flight.</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#e06c75">theta_list</span> <span style="color:#56b6c2">=</span> [<span style="color:#e06c75">theta</span>]
</span></span><span style="display:flex;"><span><span style="color:#e06c75">q_list</span> <span style="color:#56b6c2">=</span> [<span style="color:#e06c75">q</span>]
</span></span><span style="display:flex;"><span><span style="color:#e06c75">dqdt_list</span> <span style="color:#56b6c2">=</span> [<span style="color:#d19a66">0</span>]
</span></span><span style="display:flex;"><span><span style="color:#e06c75">pos_list</span> <span style="color:#56b6c2">=</span> [<span style="color:#e06c75">pos</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">copy</span>()]
</span></span><span style="display:flex;"><span><span style="color:#e06c75">velocity_list</span> <span style="color:#56b6c2">=</span> [<span style="color:#e06c75">vel</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">copy</span>()]
</span></span><span style="display:flex;"><span><span style="color:#e06c75">acceleration_list</span> <span style="color:#56b6c2">=</span> [<span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>([<span style="color:#e06c75">ax</span>, <span style="color:#e06c75">az</span>])]
</span></span></code></pre></div><p>Now, here comes the fun part: the calculation algorithm. Since we&rsquo;re essentially solving some ordinary differential equations here (The equations describe how a state variable changes over time based on the current state and possible external inputs), we can use Euler&rsquo;s method to approximate the solutions to these ODEs and iteratively update the state variables in the output lists:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># time integration using Euler&#39;s method</span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">for</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">arange</span>(<span style="color:#e06c75">dt</span>, <span style="color:#e06c75">duration</span> <span style="color:#56b6c2">+</span> <span style="color:#e06c75">dt</span>, <span style="color:#e06c75">dt</span>): <span style="color:#7f848e"># start at dt and end at &#39;duration&#39;</span>
</span></span></code></pre></div><p>We will run this from for the whole set duration of the simulation, with a time step of $dt$. Since $dt$ was set to $0.01s$, the time step will be quite small, this allows us to collect data of the rocket for each time step for the duration of the simulation, so we&rsquo;ll be calculating and storing the calculated data every $0.01s$.</p>
<p>Next, we&rsquo;ll need to calculate the instantaenous acceleration in the X and Z axes based on the forces applied on the rocket on the X and Z axes on a particular time step (by using <code>int(t/dt)</code>, we can index the $Fx$ and $Fz$ array at a the current time step $t$):</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># calculate accelerations</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">ax</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fx</span>[<span style="color:#e5c07b">int</span>(<span style="color:#e06c75">t</span><span style="color:#56b6c2">/</span><span style="color:#e06c75">dt</span>)] <span style="color:#56b6c2">/</span> <span style="color:#e06c75">mass</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">az</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fz</span>[<span style="color:#e5c07b">int</span>(<span style="color:#e06c75">t</span><span style="color:#56b6c2">/</span><span style="color:#e06c75">dt</span>)] <span style="color:#56b6c2">/</span> <span style="color:#e06c75">mass</span> <span style="color:#56b6c2">-</span> <span style="color:#e06c75">g</span>
</span></span></code></pre></div><p>Next, we&rsquo;ll calculate the angular acceleration or the rate of change of the pitch angular rate. This is calculated by just dividing the $My$ (the torque) with $inertia$ (the mass moment of inertia). Think of it as dividing the torque with the resistance to the change in inertia. This will give us the rate of change in pitch angular rate for the rocket:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># calculate angular acceleration</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">dqdt</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">My</span>[<span style="color:#e5c07b">int</span>(<span style="color:#e06c75">t</span><span style="color:#56b6c2">/</span><span style="color:#e06c75">dt</span>)] <span style="color:#56b6c2">/</span> <span style="color:#e06c75">inertia</span>
</span></span></code></pre></div><p>We&rsquo;ll also need to calculate the velocities in the X and Z axes along with the pitch angular rate with respect to the previous states:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># calculate velocities and pitch angular rate</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">u</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">ax</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">dt</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">w</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">az</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">dt</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">q</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">dqdt</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">dt</span>
</span></span></code></pre></div><p>By doing this, our simulation can process how the rocket&rsquo;s dynamics will evolve over time. We&rsquo;ll need to do the same thing to get the position, the pitch angle, and the instantenous velocity:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># calculate positions</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">pos</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">vel</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">dt</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">vel</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>([<span style="color:#e06c75">u</span>, <span style="color:#e06c75">w</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7f848e"># calculate angle</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">theta</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">q</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">dt</span>
</span></span></code></pre></div><p>Ok, that&rsquo;s all the calculations needed to be done. Now we can store all these values in their respective list:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># store data in list</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">theta_list</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">theta</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">q_list</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">q</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">dqdt_list</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">dqdt</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">pos_list</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">pos</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">copy</span>())
</span></span><span style="display:flex;"><span><span style="color:#e06c75">velocity_list</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">vel</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">copy</span>())
</span></span><span style="display:flex;"><span><span style="color:#e06c75">acceleration_list</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>([<span style="color:#e06c75">ax</span>, <span style="color:#e06c75">az</span>]))
</span></span></code></pre></div><p>Finally, to close up this time integration loop, we need a stopping condition for when the rocket hits the Earth plane. We can do this by just checking if the Z position value is less than or equal to 0 and check if the current time in the simulation is larger than 2. We need to set that time condition because we have to allow some time for the rocket to launch from 0:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># stop if the rocket returns to ground level</span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">if</span> <span style="color:#e06c75">pos</span>[<span style="color:#d19a66">1</span>] <span style="color:#56b6c2">&lt;=</span> <span style="color:#d19a66">0</span> <span style="color:#56b6c2">and</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">&gt;</span> <span style="color:#d19a66">2</span>:  <span style="color:#7f848e"># allow some time for launch</span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">break</span>
</span></span></code></pre></div><p>After the time integration, we can return the state variable lists. And that was our 3DOF function. This is the full code for the function:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#c678dd">def</span> <span style="color:#61afef;font-weight:bold">three_dof_body_axes</span>(<span style="color:#e06c75">Fx</span>, <span style="color:#e06c75">Fz</span>, <span style="color:#e06c75">My</span>, <span style="color:#e06c75">u0</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.0</span>, <span style="color:#e06c75">w0</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.0</span>, <span style="color:#e06c75">theta0</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.0</span>, <span style="color:#e06c75">q0</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.0</span>, <span style="color:#e06c75">pos0</span><span style="color:#56b6c2">=</span>[<span style="color:#d19a66">0.0</span>, <span style="color:#d19a66">0.0</span>], <span style="color:#e06c75">mass</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0</span>, <span style="color:#e06c75">inertia</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.0</span>, <span style="color:#e06c75">g</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">9.81</span>, <span style="color:#e06c75">dt</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.01</span>, <span style="color:#e06c75">duration</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">10</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e"># ensure pos0 is a float array</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">pos</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>(<span style="color:#e06c75">pos0</span>, <span style="color:#e06c75">dtype</span><span style="color:#56b6c2">=</span><span style="color:#e5c07b">float</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e"># initial conditions</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">u</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">u0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">w</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">w0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">theta</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">theta0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">q</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">q0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">vel</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>([<span style="color:#e06c75">u</span>, <span style="color:#e06c75">w</span>])
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e"># initial acceleration</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">ax</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fx</span>[<span style="color:#d19a66">0</span>] <span style="color:#56b6c2">/</span> <span style="color:#e06c75">mass</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">az</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fz</span>[<span style="color:#d19a66">0</span>] <span style="color:#56b6c2">/</span> <span style="color:#e06c75">mass</span> <span style="color:#56b6c2">-</span> <span style="color:#e06c75">g</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e"># lists to store values</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">theta_list</span> <span style="color:#56b6c2">=</span> [<span style="color:#e06c75">theta</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">q_list</span> <span style="color:#56b6c2">=</span> [<span style="color:#e06c75">q</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">dqdt_list</span> <span style="color:#56b6c2">=</span> [<span style="color:#d19a66">0</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">pos_list</span> <span style="color:#56b6c2">=</span> [<span style="color:#e06c75">pos</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">copy</span>()]
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">velocity_list</span> <span style="color:#56b6c2">=</span> [<span style="color:#e06c75">vel</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">copy</span>()]
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">acceleration_list</span> <span style="color:#56b6c2">=</span> [<span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>([<span style="color:#e06c75">ax</span>, <span style="color:#e06c75">az</span>])]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e"># time integration using Euler&#39;s method</span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">for</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">arange</span>(<span style="color:#e06c75">dt</span>, <span style="color:#e06c75">duration</span> <span style="color:#56b6c2">+</span> <span style="color:#e06c75">dt</span>, <span style="color:#e06c75">dt</span>):  <span style="color:#7f848e"># start at dt and end at &#39;duration&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7f848e"># calculate accelerations</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">ax</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fx</span>[<span style="color:#e5c07b">int</span>(<span style="color:#e06c75">t</span><span style="color:#56b6c2">/</span><span style="color:#e06c75">dt</span>)] <span style="color:#56b6c2">/</span> <span style="color:#e06c75">mass</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">az</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fz</span>[<span style="color:#e5c07b">int</span>(<span style="color:#e06c75">t</span><span style="color:#56b6c2">/</span><span style="color:#e06c75">dt</span>)] <span style="color:#56b6c2">/</span> <span style="color:#e06c75">mass</span> <span style="color:#56b6c2">-</span> <span style="color:#e06c75">g</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#7f848e"># calculate angular acceleration</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">dqdt</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">My</span>[<span style="color:#e5c07b">int</span>(<span style="color:#e06c75">t</span><span style="color:#56b6c2">/</span><span style="color:#e06c75">dt</span>)] <span style="color:#56b6c2">/</span> <span style="color:#e06c75">inertia</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#7f848e"># calculate velocities and pitch angular rate</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">u</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">ax</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">dt</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">w</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">az</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">dt</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">q</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">dqdt</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">dt</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#7f848e"># calculate positions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">pos</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">vel</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">dt</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">vel</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>([<span style="color:#e06c75">u</span>, <span style="color:#e06c75">w</span>])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#7f848e"># calculate angle</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">theta</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">q</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">dt</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#7f848e"># store data in list</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">theta_list</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">theta</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">q_list</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">q</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">dqdt_list</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">dqdt</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">pos_list</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">pos</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">copy</span>())
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">velocity_list</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">vel</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">copy</span>())
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">acceleration_list</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>([<span style="color:#e06c75">ax</span>, <span style="color:#e06c75">az</span>]))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#7f848e"># stop if the rocket returns to ground level</span>
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">if</span> <span style="color:#e06c75">pos</span>[<span style="color:#d19a66">1</span>] <span style="color:#56b6c2">&lt;=</span> <span style="color:#d19a66">0</span> <span style="color:#56b6c2">and</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">&gt;</span> <span style="color:#d19a66">2</span>:  <span style="color:#7f848e"># allow some time for launch</span>
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">break</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#98c379">&#39;theta&#39;</span> : <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>(<span style="color:#e06c75">theta_list</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#98c379">&#39;q&#39;</span> : <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>(<span style="color:#e06c75">q_list</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#98c379">&#39;dqdt&#39;</span> : <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>(<span style="color:#e06c75">dqdt_list</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#98c379">&#39;pos&#39;</span> : <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>(<span style="color:#e06c75">pos_list</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#98c379">&#39;velocity&#39;</span> : <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>(<span style="color:#e06c75">velocity_list</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#98c379">&#39;acceleration&#39;</span> : <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>(<span style="color:#e06c75">acceleration_list</span>)
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h2 id="thrust-profile">Thrust profile</h2>
<p>A rocket simulation will need some way to generate a thrust profile. The thrust profile is just how much thrust is generated at a certain time step. Our rocket will have a peak thrust of $15N$. Since we&rsquo;re trying to model our rocket kinda closely to a real model rocket (not absolutely accurate), we&rsquo;ll need to simulate some of the phases of thrust that will be in a model rocket.</p>
<p>Our rocket will have 4 phases of thrust: Rapid rise, Peak thrust, Decay phase, and Burnout:</p>
<ul>
<li>Rapid rise: In this phase, our rocket will quickly ramps up from $0N$ of thrust to $15N$ of thrust. This phase takes up $10%$ of the thrust duration. We can model this after a quadratic rise, this allows our rocket to gradually start and quickly ramp up as time passes.</li>
<li>Peak thrust: In this phase, our rocket will stay at the peak thrust of $15N$ for the duration of the phase. This phase takes up $20%$ of the thrust duration. Since the thrust value will be constant in this phase, a continous assignment is all that we&rsquo;ll need for this.</li>
<li>Decay phase: In this phase, our rocket will gradually reduce the thrust force from $15N$ to $0N$. This phase takes up $70%$ of the thrust duration. We can model this after a linear decay, which is a good approximation for thrust reduction.</li>
<li>Burnout: In this phase, our rocket&rsquo;s thrust will be $0N$. This happens after the thrust duration.</li>
</ul>
<h2 id="implementing-the-thrust-profile-generation-function">Implementing the thrust profile generation function</h2>
<p>Let&rsquo;s start implementing the thrust profile generation in Python. This function will need the simulation duration, the thrust duration, the peak thrust value, and the time step $dt$:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#c678dd">def</span> <span style="color:#61afef;font-weight:bold">generate_thrust_profile</span>(<span style="color:#e06c75">duration</span>, <span style="color:#e06c75">thrust_duration</span>, <span style="color:#e06c75">peak_thrust</span>, <span style="color:#e06c75">dt</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.01</span>):
</span></span></code></pre></div><p>We&rsquo;ll need to loop through the duration of the simulation and generate a thrust for each time interval. We&rsquo;ll save the thrust values for each time interval in a thrust profile array:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#e06c75">thrust_profile</span> <span style="color:#56b6c2">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">for</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">arange</span>(<span style="color:#d19a66">0</span>, <span style="color:#e06c75">duration</span> <span style="color:#56b6c2">+</span> <span style="color:#e06c75">dt</span>, <span style="color:#e06c75">dt</span>):
</span></span></code></pre></div><p>First, we&rsquo;ll need to implement the rapid rise phase ($10%$ of total thrust duration):</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#c678dd">if</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">&lt;</span> <span style="color:#d19a66">0.1</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e"># ignition and rapid rise (modeled as quadratic rise)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">thrust</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">peak_thrust</span> <span style="color:#56b6c2">*</span> (<span style="color:#d19a66">10</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">/</span> <span style="color:#e06c75">thrust_duration</span>)<span style="color:#56b6c2">**</span><span style="color:#d19a66">2</span>
</span></span></code></pre></div><p>We&rsquo;re basically modeling the quadratic rise here. We multiply the <code>t / thrust_duration</code> with 10 to normalize the data to a range of $[0, 1]$, this is basically the percentage time passed. Then we use the power of 2 to make this equation quadratic and the wholething with <code>peak_thrust</code> to get the thrust at $t$. This will give us a slow increase in the beginning and quick ramp up as time increases.</p>
<p>Next, we&rsquo;ll implement the peak thrust phase ($20%$ of total thrust duration):</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#c678dd">elif</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">&lt;</span> <span style="color:#d19a66">0.3</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e"># peak thrust</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">thrust</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">peak_thrust</span>
</span></span></code></pre></div><p>This will end at around $30%$ of the full thrust duration, since the rapid rise phase already took up $10%$. There&rsquo;s also no calculation here, we just assign <code>peak_thrust</code> to the <code>thrust</code> variable.</p>
<p>Next, we&rsquo;ll implement the decay phase ($70%$ of total thrust duration):</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#c678dd">elif</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">&lt;</span> <span style="color:#e06c75">thrust_duration</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e"># decay phase (modeled as linear decay)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">thrust</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">peak_thrust</span> <span style="color:#56b6c2">*</span> (<span style="color:#d19a66">1</span> <span style="color:#56b6c2">-</span> (<span style="color:#e06c75">t</span> <span style="color:#56b6c2">-</span> <span style="color:#d19a66">0.3</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>) <span style="color:#56b6c2">/</span> (<span style="color:#d19a66">0.7</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>))
</span></span></code></pre></div><p>This is modeled after linear decay. Let&rsquo;s break down each part:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>((<span style="color:#e06c75">t</span> <span style="color:#56b6c2">-</span> <span style="color:#d19a66">0.3</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>) <span style="color:#56b6c2">/</span> (<span style="color:#d19a66">0.7</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>))
</span></span></code></pre></div><p><code>(t - 0.3 * thrust_duration)</code> gives us the elapsed time since the end of the peak thrust phase, because the peak thrust phase ended at $30%$ of the duration, subtracting that from $t$ will give us the elapsed time.</p>
<p>Then we divide that with <code>(0.7 * thrust_duration)</code> to get the percentage of the elapsed time in the decay phase. Because the decay phase is $70%$ of the duration, and we want to get how long have we been in this decay phase, we divide it with <code>(0.7 * thrust_duration)</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>(<span style="color:#d19a66">1</span> <span style="color:#56b6c2">-</span> (<span style="color:#e06c75">t</span> <span style="color:#56b6c2">-</span> <span style="color:#d19a66">0.3</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>) <span style="color:#56b6c2">/</span> (<span style="color:#d19a66">0.7</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>))
</span></span></code></pre></div><p>We will subtract this division from 1 to invert the value because we want the thrust to gradually decay and we want the value of the division to gradually go down.</p>
<p>Finally, we just multiply this with the peak thrust value to get the thrust at a given time interval $t$ during the decay phase.</p>
<p>Next, we&rsquo;ll implement the burnout phase:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#c678dd">else</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e"># burnout</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">thrust</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0</span>
</span></span></code></pre></div><p>Then we just append the thrust value to the thrust profile list we initialized earlier and return it. Here&rsquo;s the full function:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#c678dd">def</span> <span style="color:#61afef;font-weight:bold">generate_thrust_profile</span>(<span style="color:#e06c75">duration</span>, <span style="color:#e06c75">thrust_duration</span>, <span style="color:#e06c75">peak_thrust</span>, <span style="color:#e06c75">dt</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.01</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">thrust_profile</span> <span style="color:#56b6c2">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">for</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">arange</span>(<span style="color:#d19a66">0</span>, <span style="color:#e06c75">duration</span> <span style="color:#56b6c2">+</span> <span style="color:#e06c75">dt</span>, <span style="color:#e06c75">dt</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">if</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">&lt;</span> <span style="color:#d19a66">0.1</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#7f848e"># ignition and rapid rise (modeled as quadratic rise)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e06c75">thrust</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">peak_thrust</span> <span style="color:#56b6c2">*</span> (<span style="color:#d19a66">10</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">/</span> <span style="color:#e06c75">thrust_duration</span>)<span style="color:#56b6c2">**</span><span style="color:#d19a66">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">elif</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">&lt;</span> <span style="color:#d19a66">0.3</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#7f848e"># peak thrust</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e06c75">thrust</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">peak_thrust</span>
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">elif</span> <span style="color:#e06c75">t</span> <span style="color:#56b6c2">&lt;</span> <span style="color:#e06c75">thrust_duration</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#7f848e"># decay phase (modeled as linear decay)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e06c75">thrust</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">peak_thrust</span> <span style="color:#56b6c2">*</span> (<span style="color:#d19a66">1</span> <span style="color:#56b6c2">-</span> (<span style="color:#e06c75">t</span> <span style="color:#56b6c2">-</span> <span style="color:#d19a66">0.3</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>) <span style="color:#56b6c2">/</span> (<span style="color:#d19a66">0.7</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#7f848e"># burnout</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e06c75">thrust</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">thrust_profile</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">thrust</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">array</span>(<span style="color:#e06c75">thrust_profile</span>)
</span></span></code></pre></div><p>Let&rsquo;s test this out by generating a thrust profile and plot it out:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># parameters</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">peak_thrust</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">15</span> <span style="color:#7f848e"># N</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">thrust_duration</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">4</span> <span style="color:#7f848e"># s</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">simulation_duration</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">30</span> <span style="color:#7f848e"># s</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">dt</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0.01</span> <span style="color:#7f848e"># time step</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7f848e"># generate thrust profile</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">thrust_profile</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">generate_thrust_profile</span>(<span style="color:#e06c75">simulation_duration</span>, <span style="color:#e06c75">thrust_duration</span>, <span style="color:#e06c75">peak_thrust</span>, <span style="color:#e06c75">dt</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">time_range</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">arange</span>(<span style="color:#d19a66">0</span>, <span style="color:#e06c75">simulation_duration</span> <span style="color:#56b6c2">+</span> <span style="color:#e06c75">dt</span>, <span style="color:#e06c75">dt</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7f848e"># plot the thrust</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">figure</span>(<span style="color:#e06c75">figsize</span><span style="color:#56b6c2">=</span>(<span style="color:#d19a66">10</span>, <span style="color:#d19a66">6</span>))
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">plot</span>(<span style="color:#e06c75">time_range</span>, <span style="color:#e06c75">thrust_profile</span>, <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;Thrust&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7f848e"># annotate the end of the stages</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">axvline</span>(<span style="color:#e06c75">x</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.1</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>, <span style="color:#e06c75">color</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;red&#39;</span>, <span style="color:#e06c75">linestyle</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;--&#39;</span>, <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;End of rapid rise&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">axvline</span>(<span style="color:#e06c75">x</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0.3</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_duration</span>, <span style="color:#e06c75">color</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;green&#39;</span>, <span style="color:#e06c75">linestyle</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;--&#39;</span>, <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;End of peak thrust&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">axvline</span>(<span style="color:#e06c75">x</span><span style="color:#56b6c2">=</span><span style="color:#e06c75">thrust_duration</span>, <span style="color:#e06c75">color</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;orange&#39;</span>, <span style="color:#e06c75">linestyle</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;--&#39;</span>, <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;End of decay phase (Burnout)&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">xlabel</span>(<span style="color:#98c379">&#39;Time (s)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">ylabel</span>(<span style="color:#98c379">&#39;Thrust (N)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">title</span>(<span style="color:#98c379">&#39;Thrust Profile&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">legend</span>()
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">grid</span>()
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">show</span>()
</span></span></code></pre></div>
    <img src="/img/tvc-modeling/thrust-profile.png"  alt="Thrust profile drop off"  class="center"  style="padding: 10px"  />


<p>We can see that the rapid rise phase starts out slowly but ramps up very quickly, the peak thrust phase is constant, and the decay phase is linear. So our function is working just fine.</p>
<p>Now that we have our thrust profile generation function, we can finally move on to using it to calculate our rocket&rsquo;s dynamics and simulate it.</p>
<h2 id="making-the-simulation">Making the simulation</h2>
<p>First, we&rsquo;ll need to initialize some parameters (using the values we measured before) and setup the initial condition of the rocket. We&rsquo;ll have a thrust peak value of $15N$ and a thrust duration of 4 seconds. We&rsquo;ll also set the simulation timeframe to 30 seconds:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># parameters</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">mass</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0.543</span> <span style="color:#7f848e"># kg</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">inertia</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0.048</span> <span style="color:#7f848e"># kg*m^2</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">g</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">9.81</span> <span style="color:#7f848e"># m/s^2</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">peak_thrust</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">15</span> <span style="color:#7f848e"># N</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">thrust_duration</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">4</span> <span style="color:#7f848e"># s</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">simulation_duration</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">30</span> <span style="color:#7f848e"># s</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">dt</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0.01</span> <span style="color:#7f848e"># time step</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">moment_arm</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0.28</span> <span style="color:#7f848e"># meters</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">gimbal_angle</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0.00</span> <span style="color:#7f848e"># radian</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7f848e"># initial conditions</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">u0</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0.0</span> <span style="color:#7f848e"># initial velocity in x (body axis)</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">w0</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0.0</span> <span style="color:#7f848e"># initial velocity in z (body axis)</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">theta0</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0.0</span> <span style="color:#7f848e"># initial pitch angle</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">q0</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0.0</span> <span style="color:#7f848e"># initial pitch rate</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">pos0</span> <span style="color:#56b6c2">=</span> [<span style="color:#d19a66">0.0</span>, <span style="color:#d19a66">0.0</span>] <span style="color:#7f848e"># initial position [x, z]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7f848e"># generate thrust profile</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">thrust_profile</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">generate_thrust_profile</span>(<span style="color:#e06c75">simulation_duration</span>, <span style="color:#e06c75">thrust_duration</span>, <span style="color:#e06c75">peak_thrust</span>, <span style="color:#e06c75">dt</span>)
</span></span></code></pre></div><p>Note on the <code>gimbal_angle</code> variable, I initialized this to $0rad$ for now. This will be the angle of the thruster gimbal. We&rsquo;ll see how changing this value will affect the rocket later on. A gimbal angle of 0 will shoot the rocket straight up.</p>
<p>Next, we&rsquo;ll need to calculate the force on the X and Z axes along with the torque based on the thrust profile:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># initialize forces and moments</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">Fx</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">sin</span>(<span style="color:#e06c75">gimbal_angle</span>) <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_profile</span> <span style="color:#7f848e"># horizontal thrust</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">Fz</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">cos</span>(<span style="color:#e06c75">gimbal_angle</span>) <span style="color:#56b6c2">*</span> <span style="color:#e06c75">thrust_profile</span> <span style="color:#7f848e"># vertical thrust</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">My</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fx</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">moment_arm</span> <span style="color:#7f848e"># pitching moment (torque)</span>
</span></span></code></pre></div><p>This is some simple trigonometry to calculate the horizontal and vertical thrust of a rocket. Let&rsquo;s try to visualize this.</p>

    <img src="/img/tvc-modeling/fx-fz-trig.png"  alt="Forces and thrust trigonometry visualization"  class="center"  style="padding: 10px"  />


<p>This is how the forces on the X and Z axes can be visualized based on the thrust direction, with $\theta$ being the gimbal angle. With this visualization, we can see how trigonometry can be applied to this problemto calculate the forces on the X and Z axes. By using the <em>soh cah toa</em> rule, we can get these 2 equations:</p>
<p>$$
\sin(\theta) = \frac{F_x}{T}, \ \cos(\theta) = \frac{F_z}{T}
$$</p>
<p>Reordering the equations will give us these new equations:</p>
<p>$$
F_x = \sin(\theta) * T, \ F_z = \cos(\theta) * T
$$</p>
<p>For the torque, we can just multiply the force applied to the rocket in the X axis with the moment arm because the horizontal thrust will generate a moment around the rocket&rsquo;s center of mass (this is used to control the pitch, that&rsquo;s why it&rsquo;s called pitching moment)</p>
<p>We finally have all the necessary values to plug into our 3DOF function. We&rsquo;ll also extract the position, velocity and acceleration results into a variable and initialize a <code>time</code> variable for plotting:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#e06c75">results</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">three_dof_body_axes</span>(<span style="color:#e06c75">Fx</span>, <span style="color:#e06c75">Fz</span>, <span style="color:#e06c75">My</span>, <span style="color:#e06c75">u0</span>, <span style="color:#e06c75">w0</span>, <span style="color:#e06c75">theta0</span>, <span style="color:#e06c75">q0</span>, <span style="color:#e06c75">pos0</span>, <span style="color:#e06c75">mass</span>, <span style="color:#e06c75">inertia</span>, <span style="color:#e06c75">g</span>, <span style="color:#e06c75">dt</span>, <span style="color:#e06c75">simulation_duration</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">time</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">np</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">arange</span>(<span style="color:#d19a66">0</span>, <span style="color:#e5c07b">len</span>(<span style="color:#e06c75">results</span>[<span style="color:#98c379">&#39;pos&#39;</span>]) <span style="color:#56b6c2">*</span> <span style="color:#e06c75">dt</span>, <span style="color:#e06c75">dt</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">pos</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">results</span>[<span style="color:#98c379">&#39;pos&#39;</span>]
</span></span><span style="display:flex;"><span><span style="color:#e06c75">velocity</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">results</span>[<span style="color:#98c379">&#39;velocity&#39;</span>]
</span></span><span style="display:flex;"><span><span style="color:#e06c75">acceleration</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">results</span>[<span style="color:#98c379">&#39;acceleration&#39;</span>]
</span></span></code></pre></div><h3 id="plotting-the-simulation-data-with-no-gimbal-angle">Plotting the simulation data with no gimbal angle</h3>
<p>Let&rsquo;s plot all these results out to see how our rocket performed. We&rsquo;ll plot out the data on the Z axis first:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># plot data (Z axis)</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">figure</span>(<span style="color:#e06c75">figsize</span><span style="color:#56b6c2">=</span>(<span style="color:#d19a66">12</span>, <span style="color:#d19a66">8</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">subplot</span>(<span style="color:#d19a66">3</span>, <span style="color:#d19a66">1</span>, <span style="color:#d19a66">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">plot</span>(<span style="color:#e06c75">time</span>, <span style="color:#e06c75">pos</span>[:, <span style="color:#d19a66">1</span>], <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;Z Position&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">xlabel</span>(<span style="color:#98c379">&#39;Time (s)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">ylabel</span>(<span style="color:#98c379">&#39;Z Position (m)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">title</span>(<span style="color:#98c379">&#39;Z Position Data&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">legend</span>()
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">grid</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">subplot</span>(<span style="color:#d19a66">3</span>, <span style="color:#d19a66">1</span>, <span style="color:#d19a66">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">plot</span>(<span style="color:#e06c75">time</span>, <span style="color:#e06c75">velocity</span>[:, <span style="color:#d19a66">1</span>], <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;Z Velocity&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">xlabel</span>(<span style="color:#98c379">&#39;Time (s)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">ylabel</span>(<span style="color:#98c379">&#39;Z Velocity (m/s)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">title</span>(<span style="color:#98c379">&#39;Z Velocity Data&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">legend</span>()
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">grid</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">subplot</span>(<span style="color:#d19a66">3</span>, <span style="color:#d19a66">1</span>, <span style="color:#d19a66">3</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">plot</span>(<span style="color:#e06c75">time</span>, <span style="color:#e06c75">acceleration</span>[:, <span style="color:#d19a66">1</span>], <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;Z Acceleration&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">xlabel</span>(<span style="color:#98c379">&#39;Time (s)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">ylabel</span>(<span style="color:#98c379">&#39;Z Acceleration (m/s^2)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">title</span>(<span style="color:#98c379">&#39;Z Acceleration Data&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">legend</span>()
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">grid</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">tight_layout</span>()
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">show</span>()
</span></span></code></pre></div>
    <img src="/img/tvc-modeling/z-data-plot-1.png"  alt="Z data plots 1"  class="center"  style="padding: 10px"  />


<p>Look at those curves. We can see that our rocket can reach an altitude of around a bit over $100m$ with a maximum velocity of around $30m/s$. We can also see that initially, the rocket acceleration was around $-10m/s^2$. This is because the rocket was under the influence of gravity, so before the rocket is launched, it is always experiencing around $-9.81m/s^2$ of acceleration. And at around a few milliseconds after launch, the acceleration broke even with the gravitational pull, hitting $0m/s^2$, and a few milliseconds after that, it reached an acceleration of around $15m/s^2$, then the rocket enters the decay phase and the acceleration gradually dropped off.</p>
<p>Now, let&rsquo;s take a look at the data on the X axis:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># plot data (X axis)</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">figure</span>(<span style="color:#e06c75">figsize</span><span style="color:#56b6c2">=</span>(<span style="color:#d19a66">12</span>, <span style="color:#d19a66">8</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">subplot</span>(<span style="color:#d19a66">3</span>, <span style="color:#d19a66">1</span>, <span style="color:#d19a66">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">plot</span>(<span style="color:#e06c75">time</span>, <span style="color:#e06c75">pos</span>[:, <span style="color:#d19a66">0</span>], <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;X Position&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">xlabel</span>(<span style="color:#98c379">&#39;Time (s)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">ylabel</span>(<span style="color:#98c379">&#39;X Position (m)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">title</span>(<span style="color:#98c379">&#39;X Position Data&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">legend</span>()
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">grid</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">subplot</span>(<span style="color:#d19a66">3</span>, <span style="color:#d19a66">1</span>, <span style="color:#d19a66">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">plot</span>(<span style="color:#e06c75">time</span>, <span style="color:#e06c75">velocity</span>[:, <span style="color:#d19a66">0</span>], <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;X Velocity&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">xlabel</span>(<span style="color:#98c379">&#39;Time (s)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">ylabel</span>(<span style="color:#98c379">&#39;X Velocity (m/s)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">title</span>(<span style="color:#98c379">&#39;X Velocity Data&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">legend</span>()
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">grid</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">subplot</span>(<span style="color:#d19a66">3</span>, <span style="color:#d19a66">1</span>, <span style="color:#d19a66">3</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">plot</span>(<span style="color:#e06c75">time</span>, <span style="color:#e06c75">acceleration</span>[:, <span style="color:#d19a66">0</span>], <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;X Acceleration&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">xlabel</span>(<span style="color:#98c379">&#39;Time (s)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">ylabel</span>(<span style="color:#98c379">&#39;X Acceleration (m/s^2)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">title</span>(<span style="color:#98c379">&#39;X Acceleration Data&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">legend</span>()
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">grid</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">tight_layout</span>()
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">show</span>()
</span></span></code></pre></div>
    <img src="/img/tvc-modeling/x-data-plot-1.png"  alt="X data plots 1"  class="center"  style="padding: 10px"  />


<p>Recall when we were setting the parameters for the simulation, we set the <code>gimbal_angle</code> variable to $0rad$. This means the thruster won&rsquo;t move at all and the rocket will shoot straight up and won&rsquo;t move horizontally at all. That&rsquo;s why the data in the X axis is all 0 because nothing is happening in the X axis yet.</p>
<p>Let&rsquo;s try plotting out the trajectory of the rocket to get a better idea of how the rocket will fly:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># plot trajectory of rocket (2D)</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">figure</span>(<span style="color:#e06c75">figsize</span><span style="color:#56b6c2">=</span>(<span style="color:#d19a66">8</span>, <span style="color:#d19a66">5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">plot</span>(<span style="color:#e06c75">pos</span>[:, <span style="color:#d19a66">0</span>], <span style="color:#e06c75">pos</span>[:, <span style="color:#d19a66">1</span>], <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;Rocket Trajectory&#39;</span>, <span style="color:#e06c75">color</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;blue&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">scatter</span>(<span style="color:#e06c75">pos</span>[<span style="color:#d19a66">0</span>, <span style="color:#d19a66">0</span>], <span style="color:#e06c75">pos</span>[<span style="color:#d19a66">0</span>, <span style="color:#d19a66">1</span>], <span style="color:#e06c75">color</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;green&#39;</span>, <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;Launch Point&#39;</span>) <span style="color:#7f848e"># mark the launch point</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">scatter</span>(<span style="color:#e06c75">pos</span>[<span style="color:#56b6c2">-</span><span style="color:#d19a66">1</span>, <span style="color:#d19a66">0</span>], <span style="color:#e06c75">pos</span>[<span style="color:#56b6c2">-</span><span style="color:#d19a66">1</span>, <span style="color:#d19a66">1</span>], <span style="color:#e06c75">color</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;red&#39;</span>, <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;Impact Point&#39;</span>) <span style="color:#7f848e"># mark the impact point</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">axhline</span>(<span style="color:#d19a66">0</span>, <span style="color:#e06c75">color</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;black&#39;</span>, <span style="color:#e06c75">linestyle</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;--&#39;</span>, <span style="color:#e06c75">label</span><span style="color:#56b6c2">=</span><span style="color:#98c379">&#39;Ground&#39;</span>) <span style="color:#7f848e"># ground level</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">xlabel</span>(<span style="color:#98c379">&#39;X Position (m)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">ylabel</span>(<span style="color:#98c379">&#39;Z Position (m)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">title</span>(<span style="color:#98c379">&#39;Rocket Trajectory&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">legend</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">plt</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">show</span>()
</span></span></code></pre></div>
    <img src="/img/tvc-modeling/rocket-trajectory-1.png"  alt="Rocket trajectory plot 1"  class="center"  style="padding: 10px"  />


<p>The rocket just shoots straight up to an altitude of around a little bit over $100m$ then drop straight down to the ground.</p>
<h3 id="plotting-the-simulation-data-with-some-gimbal-angle">Plotting the simulation data with some gimbal angle</h3>
<p>Now let&rsquo;s see how our rocket will fly with some gimbal angle. To do this, we can just adjust our <code>gimbal_angle</code> variable. I&rsquo;ll adjust it by a tiny bit:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#e06c75">gimbal_angle</span> <span style="color:#56b6c2">=</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">0.05</span> <span style="color:#7f848e"># radian</span>
</span></span></code></pre></div><p>And let&rsquo;s rerun the simulation.</p>
<ul>
<li>Z axis data:</li>
</ul>

    <img src="/img/tvc-modeling/z-data-plot-2.png"  alt="Z data plots 2"  class="center"  style="padding: 10px"  />


<ul>
<li>X axis data:</li>
</ul>

    <img src="/img/tvc-modeling/x-data-plot-2.png"  alt="X data plots 2"  class="center"  style="padding: 10px"  />


<p>So the data on the Z axis remains unchanged from the last time we run the simulation, but the data on the X axis changed a lot. We can see that the X position data is gradually moving towards a different position, this indicates that the rocket is actually moving in the X axis. We can see the velocity data is also decreasing to the negative range since we&rsquo;re moving to the left side. And we can also see the acceleration data on the X axis.</p>
<p>Let&rsquo;s see the flight trajectory:</p>

    <img src="/img/tvc-modeling/rocket-trajectory-2.png"  alt="Rocket trajectory plot 2"  class="center"  style="padding: 10px"  />


<p>And there we go. The rocket flies all the way over $100m$ and land at just over $30m$ from its initial launch point. We have successfully modeled a TVC rocket in Python.</p>
<h2 id="conclusion">Conclusion</h2>
<p>We have successfully modeled a TVC rocket in Python with 3 degrees of freedom. We&rsquo;ve covered what 3 degrees of freedom is, what thrust curve is, how to implement some equations to model the rocket and how to plot out the simulated rocket&rsquo;s data and trajectory.</p>
<p>There&rsquo;s a lot more to be done for this project like more realistic thrust curve, add in other external factors such as wind and air resistances, and implement a PID or a thrust vector control method to control this rocket. I might get around implementing these things into the simulation in the future.</p>
<p>This was a very fun project. I definitely learned a lot about rocketry from this, and I hope you can learn more about rocketry and rocket dynamics simulation from this blog post.</p>
<blockquote>
<p>You can check out the source code for this project <a href="https://github.com/namberino/tvc-sim">here</a></p>
</blockquote>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://namberino.github.io/tags/programming/">programming</a></span>
        <span class="tag"><a href="https://namberino.github.io/tags/science/">science</a></span>
        <span class="tag"><a href="https://namberino.github.io/tags/simulation/">simulation</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        4251 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2024-06-05 20:31
        

         
          
        
      </p>
    </div>
      <hr />
      <div class="sharing-buttons">
        
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnamberino.github.io%2fposts%2f2024%2f06%2fmodeling-a-thrust-vector-control-rocket-in-python%2f" target="_blank" rel="noopener" aria-label="" title="Share on facebook">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fnamberino.github.io%2fposts%2f2024%2f06%2fmodeling-a-thrust-vector-control-rocket-in-python%2f" target="_blank" rel="noopener" aria-label="" title="Share on twitter">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=Modeling%20a%20Thrust%20Vector%20Control%20Rocket%20in%20Python&amp;caption=Modeling%20a%20Thrust%20Vector%20Control%20Rocket%20in%20Python&amp;canonicalUrl=https%3a%2f%2fnamberino.github.io%2fposts%2f2024%2f06%2fmodeling-a-thrust-vector-control-rocket-in-python%2f" target="_blank" rel="noopener" aria-label="" title="Share on tumblr">
  <div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small">
    <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093 0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941 0 9.999 0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="mailto:?subject=Modeling%20a%20Thrust%20Vector%20Control%20Rocket%20in%20Python&amp;body=https%3a%2f%2fnamberino.github.io%2fposts%2f2024%2f06%2fmodeling-a-thrust-vector-control-rocket-in-python%2f" target="_self" rel="noopener" aria-label="" title="Share via email">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fnamberino.github.io%2fposts%2f2024%2f06%2fmodeling-a-thrust-vector-control-rocket-in-python%2f&amp;media=https%3a%2f%2fnamberino.github.io%2fposts%2f2024%2f06%2fmodeling-a-thrust-vector-control-rocket-in-python%2f;description=Modeling%20a%20Thrust%20Vector%20Control%20Rocket%20in%20Python" target="_blank" rel="noopener" aria-label="" title="Share on pinterest">
  <div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017 0z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fnamberino.github.io%2fposts%2f2024%2f06%2fmodeling-a-thrust-vector-control-rocket-in-python%2f&amp;title=Modeling%20a%20Thrust%20Vector%20Control%20Rocket%20in%20Python&amp;summary=Modeling%20a%20Thrust%20Vector%20Control%20Rocket%20in%20Python&amp;source=https%3a%2f%2fnamberino.github.io%2fposts%2f2024%2f06%2fmodeling-a-thrust-vector-control-rocket-in-python%2f" target="_blank" rel="noopener" aria-label="" title="Share on linkedin">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3a%2f%2fnamberino.github.io%2fposts%2f2024%2f06%2fmodeling-a-thrust-vector-control-rocket-in-python%2f&amp;resubmit=true&amp;title=Modeling%20a%20Thrust%20Vector%20Control%20Rocket%20in%20Python" target="_blank" rel="noopener" aria-label="" title="Share on reddit">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2fnamberino.github.io%2fposts%2f2024%2f06%2fmodeling-a-thrust-vector-control-rocket-in-python%2f;title=Modeling%20a%20Thrust%20Vector%20Control%20Rocket%20in%20Python" target="_blank" rel="noopener" aria-label="" title="Share on xing">
  <div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="whatsapp://send?text=Modeling%20a%20Thrust%20Vector%20Control%20Rocket%20in%20Python%20https%3a%2f%2fnamberino.github.io%2fposts%2f2024%2f06%2fmodeling-a-thrust-vector-control-rocket-in-python%2f" target="_blank" rel="noopener" aria-label="" title="Share on whatsapp">
  <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnamberino.github.io%2fposts%2f2024%2f06%2fmodeling-a-thrust-vector-control-rocket-in-python%2f&amp;t=Modeling%20a%20Thrust%20Vector%20Control%20Rocket%20in%20Python" target="_blank" rel="noopener" aria-label="" title="Share on hacker news">
  <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=Modeling%20a%20Thrust%20Vector%20Control%20Rocket%20in%20Python&amp;url=https%3a%2f%2fnamberino.github.io%2fposts%2f2024%2f06%2fmodeling-a-thrust-vector-control-rocket-in-python%2f" target="_blank" rel="noopener" aria-label="" title="Share on telegram">
  <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
    </div>
  </div>
</a>

      </div>

    
    <div class="pagination">
        

        <div class="pagination__buttons">
            
            <span class="button previous">
                <a href="https://namberino.github.io/posts/2024/06/lets-make-an-operating-system-the-boot-sector-part-1/">
                    <span class="button__icon">←</span>
                    <span class="button__text">Let&#39;s make an Operating System: The boot sector [Part 1]</span>
                </a>
            </span>
            

            
            <span class="button next">
                <a href="https://namberino.github.io/posts/2024/06/lets-make-an-operating-system-the-beginning/">
                    <span class="button__text">Let&#39;s make an Operating System: The beginning</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

    

  </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js" integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc&#43;cxaJzDdCYbAW0X1G&#43;DgZYvtKFXe6MBex8jUJ2JT25mQx&#43;YjACIng=="></script>




    </body>
</html>
